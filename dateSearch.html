    <head>
    <title>算錢森</title>
    <script src="js/jquery-3.2.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/fdb-all.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.9.0/firebase.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <!-- my import -->
    <link href="css/main.css">
    <script src="js/main.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src *; style-src *  'unsafe-inline'; script-src *  'unsafe-inline'; media-src *">
</head>
<body>
    <h1>支出查詢</h1>
    <div class="radio">
        <label><input type="radio" name="time" id="thisMonth">這個月</label>
    </div>
    <div class="radio">
        <label><input type="radio" name="time" id="selectMonth">指定日期</label>
    </div>
    <input type="date" id="startDate"> - <input type="date" id="endDate">
    <a class="btn btn-primary btn-lg" onclick="searchDetail()">搜尋</a>
  <table id="timeTable" class='table table-hover'>
    <thead>
      <tr>
        <th>Item Name</th>
        <th>Item type</th>
        <th>Item price</th>
        <th>Item date</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>  
  <table id="typeTable" class='table table-hover' style="margin-top: 30px;">
    <thead>
      <tr>
        <th>Type</th>
        <th>Total Price</th>
        <th>Percent</th>
      </tr>
    </thead>
    <tbody>                  
    </tbody>
  </table>  
  <script>
    var sum = [0,0,0,0,0,0];
    var type = ["食","飲","行","育","樂","其他"];
      function searchDetail(){

        var totalPrice =0;
        var query;
        if($("input#thisMonth:checked").length!=0){
            var date = new Date();
            var month = date.getMonth()+1;
            var nextmonth = month+1;
            var year = date.getFullYear(); 
            if(month<10){
                month = "0"+month;
            }
            if(nextmonth<10){
                nextmonth = "0"+nextmonth;
            }
            query={
                date: {
                    "$gt": year+"-"+month+"-0"+1,
                    "$lt": year+"-"+nextmonth+"-0"+1
                }
            }
        }
        else if($("input#selectMonth:checked").length!=0){
             query={
                date: {
                    "$gt": $("input#startDate").val(),
                    "$lt": $("input#endDate").val()
                }
            }

        }

        query2 = { $orderBy: {date:-1},$limit: 10};


        var result = MoneyCollection.find(query,query2);
        $("table#commenttable tbody").text("");
        for(var i=0;i<result.length;i++){
            var commentdata="<tr><td>"+result[i].name+"</td><td>"+result[i].type+"</td><td>"+result[i].number+"</td><td>"+result[i].date+"</tr>";
            $("table#timeTable tbody").append(commentdata);
//類別搜尋累積
            switch(result[i].type){
          case "食":
            this.sum[0] = this.sum[0] + result[i].number/1
            break;
          case "飲":
            this.sum[1] = this.sum[1] + result[i].number/1
            break;
          case "行":
            this.sum[2] = this.sum[2] + result[i].number/1
            break;
          case "育":
            this.sum[3] = this.sum[3] + result[i].number/1
            break;
          case "樂":
            this.sum[4] = this.sum[4] + result[i].number/1
            break;
          default:
            this.sum[5] = this.sum[5] + result[i].number/1
            break;
        }
            totalPrice = totalPrice + result[i].number/1
        }
        countTypeTotal(totalPrice);
      }
      function countTypeTotal(totalPrice){
        $("table#commenttable tbody").text("");
        for(var i=0;i<sum.length;i++){
            var commentdata = "<tr><td>"+type[i]+"</td><td>"+sum[i]+"</td><td>"+Math.floor((sum[i]/totalPrice)*100)+"%</td></tr>";
            $("table#typeTable tbody").append(commentdata);
        }


      }
  </script>
</body>
